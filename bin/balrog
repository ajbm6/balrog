#!/usr/bin/env php
<?php

if ((!@include __DIR__.'/../../../autoload.php') && (!@include __DIR__.'/../vendor/autoload.php')) {
    die('You must set up the project dependencies, run the following commands:'.PHP_EOL.
        'curl -s https://getcomposer.org/installer | php'.PHP_EOL.
        'php composer.phar install'.PHP_EOL);
}

$filename = __DIR__.'/../src/balrog.lisphp';

$environment = Lisphp_Environment::full();
$scope = new Lisphp_Scope($environment);

$scope['require'] = new Lisphp_Runtime_PHPFunction(function ($file) use ($scope) {
    $program = Lisphp_Program::load(__DIR__.'/../src/'.$file.'.lisphp');
    return $program->execute($scope);
});

$program = Lisphp_Program::load($filename);
$program->execute($scope);
